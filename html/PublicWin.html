<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>曝光吧</title>
    <link rel="stylesheet" type="text/css" href="../css/ciacloud.css"/>
    <link rel="stylesheet" type="text/css" href="../css/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../css/publicWin.css"/>
    <style>

    </style>

</head>

<body>

<!-- DefaultHeader 公共头部-->
<header id="DefaultHeader" class="cia-bar cia-bar-nav DefaultHeader none">
    <!-- 窗口名称 -->
    <div class="cia-title" id="DefaultHeadertitle">新窗口</div>
    <!-- 左侧返回按钮 -->
    <a class="cia-btn cia-pull-left" tapmode onclick="_CloseWin()">
        <span class="CIACloud-font icon-zuojiantou"></span></a>
    <!-- 右侧分享按钮 -->
    <a id="ShareBtn" class="cia-btn cia-pull-right HeaderBtn-Share none" tapmode onclick="actionMenu()">
        <span class="CIACloud-font icon-share"></span></a>
    <!-- 右侧新增按钮 -->
    <a class="cia-btn cia-pull-right HeaderBtn-FeedBackAdd none" onclick="openWin(this);" type="Submit" Path="Setting"
       name="FeedBack_Add" title="意见反馈">新增</a>
    <!-- 右侧发送按钮 -->
    <a id="save" class="cia-btn cia-pull-right HeaderBtn-Submit none" tapmode onclick="SubmitBtn()">
        <i class="aui-iconfont aui-icon-correct"></i></a>
</header>

</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/Base.js"></script>

<script type="text/javascript">
    var dialogBox;
    apiready = function () {
        api.parseTapmode();
        //获取新窗口属性
        var type = api.pageParam.type;
        //选择新窗口容器
        SelectWinHeaderInfo(type, api.pageParam);
        dialogBox = api.require('dialogBox');
        _AddEventListener("actionMenu", function (data) {
            if (data != '' && data != undefined) {
                actionMenu(data);
            } else {
                _toast('获取参数失败，请重新点击分享按钮~！')
            }

        });

    };

    //打开新窗口
    function SelectWinHeaderInfo(type, pageParamData) {
        //显示头部
        switch (type) {
            case 'Search':
                //搜索窗口
                $api.removeCls($api.dom('.SearchHeader'), 'none');
                var headerPos = $api.offset(SearchHeader);
                var frameheight = api.winHeight - headerPos.h;
                openFrame(headerPos, frameheight, pageParamData);
                break;
            case 'Detail':
                $api.removeCls($api.dom('.DefaultHeader'), 'none');
                $api.removeCls($api.dom('#ShareBtn'), 'none');
                var headerPos = $api.offset(DefaultHeader);
                var frameheight = api.winHeight - headerPos.h;
                openFrame(headerPos, frameheight, pageParamData);
                break;
            case 'Add':
                $api.removeCls($api.dom('.DefaultHeader'), 'none');
                $api.removeCls($api.dom('#save'), 'none');
                var headerPos = $api.offset(DefaultHeader);
                var frameheight = api.winHeight - headerPos.h;
                openFrame(headerPos, frameheight, pageParamData);
                break;
            default:
                //常规窗口
                $api.removeCls($api.dom('.DefaultHeader'), 'none');
                var headerPos = $api.offset(DefaultHeader);
                var frameheight = api.winHeight - headerPos.h;
                openFrame(headerPos, frameheight, pageParamData);
                break;
        }
    }

    //======================= 封装窗口方法  =======================//

    //封装openFrame方法
    function openFrame(headerPos, frameheight, pageParamData) {
        //获取窗口数据
        var title = api.pageParam.title;
        var frameurl = api.pageParam.frameurl;
        //更改窗口头部信息
        $api.text($api.byId("DefaultHeadertitle"), title);
        api.openFrame({
            name: api.winName,
            url: frameurl,
            bounces: false,
            allowEdit: true,
            rect: {
                x: 0,
                y: headerPos.h,
                w: api.winWidth,
                h: frameheight
            },
            pageParam: pageParamData,
        });
    }

    //openFrame end
    function actionMenu() {
        var data = api.pageParam.article;
//        _Alert(data)
        dialogBox.share({
            rect: {
                w: 330,
                h: 290
            },
            items: [{
                text: '微信朋友圈',
                icon: 'widget://image/shouye/wk.png'
            }, {
                text: '微信好友',
                icon: 'widget://image/shouye/wx.png'
            }, {
                text: 'QQ好友',
                icon: 'widget://image/shouye/qq.png'
            }, {
                text: 'QQ空间',
                icon: 'widget://image/shouye/qk.png'
            }, {
                text: '微博',
                icon: 'widget://image/shouye/wb.png'
            }, {
                text: '支付宝',
                icon: 'widget://image/shouye/zfb.png'
            }],

            styles: {
                bg: '#f4f4f4',
                column: 3,
                horizontalSpace: 15,
                verticalSpace: 30,
                itemText: {
                    color: '#000',
                    size: 15,
                    marginT: 10
                },
                itemIcon: {
                    size: 60
                }
            },
            tapClose: true
        }, function (ret) {
            switch (ret.index) {
                case 0:
                    var wx = api.require('wx');
                    wx.shareWebpage({
                        scene: 'timeline',
                        title: data.title,
                        description: data.content,
                        thumb: data.authorImg,
                        contentUrl: 'http://bbaaoo.cn:7001/public/article_detail.html?aid=' + data.id
                    }, function (ret, err) {
                        if (ret.status) {
                            alert('分享成功');
                        } else {
                            alert(err.code);
                        }
                    });
                    break;
                case 1:
                    var wx = api.require('wx');
                    wx.shareWebpage({
                        scene: 'session',
                        title: data.title,
                        description: data.content,
                        thumb: data.authorImg,
                        contentUrl: 'http://bbaaoo.cn:7001/public/article_detail.html?aid=' + data.id
                    }, function (ret, err) {

                    });
                    break;
                case 2:
                    var qq = api.require('qq');
                    qq.shareNews({
                        url: 'http://bbaaoo.cn:7001/public/article_detail.html?aid=' + data.id,
                        title: data.title,
                        description: data.content,
                        imgUrl: data.authorImg,
                        type: "QFriend"
                    });

                    break;
                case 3:
                    var qq = api.require('qq');
                    qq.shareNews({
                        url: 'http://bbaaoo.cn:7001/public/article_detail.html?aid=' + data.id,
                        title: data.title,
                        description: data.content,
                        imgUrl: data.authorImg
                    });
                    break;
                case 4:
                    alert('即将接入~');
                    break;
                case 5:
                    alert('即将接入~');
                    break;
            }
        });
    }

    function SubmitBtn() {
        _SendEvent("a_submit");
    }
</script>
